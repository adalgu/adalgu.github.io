# 노션 DB 자동 설정 및 마이그레이션 기능 추가 (2025-03-14)

## 요약

Notion-Hugo 통합 파이프라인에 노션 데이터베이스 자동 설정 및 마이그레이션 기능을 추가했습니다. 이 기능을 통해 사용자가 노션 데이터베이스를 수동으로 설정하지 않고도 명령어 한 번으로 필요한 환경을 구성할 수 있으며, 기존 노션 데이터베이스에서 Hugo 형식으로 콘텐츠를 마이그레이션 할 수 있게 되었습니다.

## 주요 변경사항

### 1. 노션 DB 설정 모듈 구현 (`src/notion_setup.py`)

- 노션 API를 통한 데이터베이스 생성 및 설정 자동화
- `NotionSetup` 클래스 구현

  - `create_hugo_database()`: Hugo 블로그에 필요한 속성을 갖춘 데이터베이스 생성
  - `create_sample_post()`: 시작하기 위한 샘플 블로그 포스트 생성
  - `update_config()`: 설정 파일 자동 업데이트

- `NotionMigration` 클래스 구현 (상속)
  - 소스 데이터베이스 구조 검증
  - 데이터베이스 속성 및 컨텐츠 마이그레이션
  - 코드 블록 자동 분할 등 복잡한 컨텐츠 처리

### 2. 명령줄 인터페이스 확장 (`src/notion_hugo.py`)

- 데이터베이스 설정 관련 인자 추가

  - `--setup-db`: 새 노션 데이터베이스 생성 및 설정
  - `--parent-page`: 상위 페이지 ID (데이터베이스 생성 위치)
  - `--db-name`: 데이터베이스 이름 설정
  - `--target-folder`: 콘텐츠 대상 폴더 지정

- 마이그레이션 관련 인자 추가

  - `--migrate-db`: 기존 데이터베이스에서 마이그레이션
  - `--source-db`: 소스 데이터베이스 ID

- 실행 함수 구현
  - `run_setup_database()`: 데이터베이스 설정 로직
  - `run_migrate_database()`: 마이그레이션 로직
  - `main()` 함수 확장으로 새 명령 처리

### 3. 앱 도움말 개선 (`notion_hugo_app.py`)

- 새 기능에 대한 도움말 추가
- 각 설정 옵션에 대한 설명 및 기본값 명시
- 사용 예시 추가로 사용성 개선

## 기술적 세부사항

### 데이터베이스 설정 프로세스

1. NOTION_TOKEN 환경 변수 확인
2. 부모 페이지 ID에 새 데이터베이스 생성
3. Hugo 블로그에 필요한 속성 구성 (Name, Description, Tags 등)
4. 샘플 포스트 생성 및 기본 콘텐츠 삽입
5. `notion-hugo.config.yaml` 파일 자동 업데이트

### 마이그레이션 프로세스

1. 소스 데이터베이스 구조 검증
   - 필수 속성 확인 (Name, isPublished, Description, Tags 등)
   - 속성 타입 검증 및 호환성 확인
2. 새 데이터베이스 생성 (설정 프로세스 재사용)
3. 페이지 콘텐츠 변환
   - 블록 유효성 검증 및 변환
   - 너무 긴 코드 블록 자동 분할 (Notion API 2000자 제한 우회)
4. 페이지 속성 변환 및 마이그레이션
5. 진행 상황 로깅 및 결과 보고

### 확장성 고려사항

- 커스텀 태그 매핑 지원 (미리 정의된 태그 변환)
- 특수 블록 타입 처리 (이미지, 파일, 표, 북마크 등)
- 오류 복구 메커니즘 (문제 페이지 건너뛰기, 로그 유지)
- 충분한 로깅으로 문제 해결 지원

## 사용 예시

### 새 데이터베이스 설정

```bash
python notion_hugo_app.py --setup-db --parent-page=123456789abcdef --db-name="My Blog Posts"
```

### 기존 데이터베이스 마이그레이션

```bash
python notion_hugo_app.py --migrate-db --source-db=123456789abcdef --parent-page=987654321fedcba
```

## 향후 개선 사항

- 태그 자동 추출 및 제안 기능
- 데이터베이스 스키마 편집 기능
- 증분 마이그레이션 지원 (이미 마이그레이션된 페이지 건너뛰기)
- 마이그레이션 시 선택적 페이지 마이그레이션 지원
- 웹 인터페이스를 통한 설정 및 마이그레이션
